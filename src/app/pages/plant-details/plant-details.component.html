<div [class.details-displayed]="isDetailsDisplayed">
    <ng-container [ngTemplateOutlet]="swiperContainers" />
    <div class="plant-info-container">
        <ng-container [ngTemplateOutlet]="title" />
        <ng-container [ngTemplateOutlet]="matTabs" />
    </div>
</div>

<!--Carousel template-->
<ng-template #swiperContainers>
    <div class="carousel-wrapper">
        <swiper-container thumbs-swiper=".thumbs">
            @for (image of plant.images; track image) {
                <swiper-slide
                    lazy="true"
                    class="main-slide">
                    <img
                        class="plant-image"
                        [src]="image.url"
                        loading="lazy"
                        [alt]="image.attribution" />
                </swiper-slide>
            }
        </swiper-container>
        <swiper-container
            class="thumbs"
            free-mode="true"
            slides-per-view="3.5"
            watch-slides-progress="true">
            @for (image of plant.images; track image) {
                <swiper-slide lazy="true">
                    <img
                        [src]="image.url"
                        loading="lazy"
                        [alt]="image.attribution" />
                </swiper-slide>
            }
        </swiper-container>
    </div>
</ng-template>

<!--Field template-->
<ng-template
    #field
    let-label="label"
    let-data="data">
    <section>
        <div>
            <span>{{ label | titlecase }}</span>
            <span>{{ data }}</span>
        </div>
        <ng-content select="content"></ng-content>
    </section>
</ng-template>

<!--Mat tabs template-->
<ng-template #matTabs>
    <mat-tab-group>
        <mat-tab label="Taxonomy">
            <ng-container
                [ngTemplateOutlet]="field"
                [ngTemplateOutletContext]="{ data: plant.scientificName, label: 'scientific name' }" />
            <ng-container
                [ngTemplateOutlet]="field"
                [ngTemplateOutletContext]="{ data: plant.commonName, label: 'common name' }" />
            <ng-container
                [ngTemplateOutlet]="field"
                [ngTemplateOutletContext]="{ data: plant.genus, label: 'genus' }" />
            <ng-container
                [ngTemplateOutlet]="field"
                [ngTemplateOutletContext]="{ data: plant.family, label: 'family' }" />
        </mat-tab>
        <mat-tab label="Characteristics">
            <app-plant-details-section
                label="biome"
                [data]="plant.biome" />
            <ng-container
                [ngTemplateOutlet]="field"
                [ngTemplateOutletContext]="{ data: plant.cycle, label: 'cycle' }" />
            <ng-container
                [ngTemplateOutlet]="field"
                [ngTemplateOutletContext]="{ data: plant.description, label: 'description' }" />
            <ng-container
                [ngTemplateOutlet]="field"
                [ngTemplateOutletContext]="{
                    data: plant.width.value + plant.width.unit + ' x ' + plant.height.value + plant.height.unit,
                    label: 'size',
                }" />
            <ng-container
                [ngTemplateOutlet]="field"
                [ngTemplateOutletContext]="{ data: plant.layer, label: 'layer' }" />
            <ng-container
                [ngTemplateOutlet]="field"
                [ngTemplateOutletContext]="{ data: getAnatomicalParts(), label: 'anatomy (parts)' }" />
        </mat-tab>
        <mat-tab label="Water">
            <app-plant-details-section
                [data]="plant.waterRequirement.toString()"
                label="requirement">
                <div class="requirement-container water">
                    @for (level of [0, 1, 2, 3, 4]; track level) {
                        <mat-icon [class.filled]="level <= waterRequirementLevel">water_drop</mat-icon>
                    }
                </div>
            </app-plant-details-section>
            <ng-container
                [ngTemplateOutlet]="field"
                [ngTemplateOutletContext]="{ data: plant.wateringPeriods, label: 'periods' }" />
            <div class="chart-container">
                <ngx-charts-bar-vertical
                    [xAxis]="true"
                    [yAxis]="true"
                    [legend]="false"
                    [autoScale]="true"
                    [showGridLines]="false"
                    [results]="waterConsumptionResults"></ngx-charts-bar-vertical>
            </div>
        </mat-tab>
        <mat-tab label="Light">
            <app-plant-details-section
                [data]="plant.lightRequirement.toString()"
                label="requirement">
                <div class="requirement-container light">
                    @for (level of [0, 1, 2, 3, 4]; track level) {
                        <mat-icon [class.filled]="level <= lightRequirementLevel">wb_sunny</mat-icon>
                    }
                </div>
            </app-plant-details-section>
            <ng-container
                [ngTemplateOutlet]="field"
                [ngTemplateOutletContext]="{
                    data: plant.lightDuration.min + ' - ' + plant.lightDuration.max + ' ' + plant.lightDuration.unit,
                    label: 'light duration',
                }" />
        </mat-tab>
        <mat-tab label="Care">
            <app-plant-details-section
                [data]="plant.careRequirement.toString()"
                label="requirement">
                <div class="requirement-container care">
                    @for (level of [0, 1, 2, 3, 4]; track level) {
                        <mat-icon [class.filled]="level <= careRequirementLevel">park</mat-icon>
                    }
                </div>
            </app-plant-details-section>
            <ng-container
                [ngTemplateOutlet]="field"
                [ngTemplateOutletContext]="{
                    data: plant.hardinessZone.min + ' - ' + plant.hardinessZone.max,
                    label: 'hardiness zone',
                }" />
            <ng-container
                [ngTemplateOutlet]="field"
                [ngTemplateOutletContext]="{ data: plant.soilType, label: 'soil type' }" />
        </mat-tab>
        <mat-tab label="Edibility">
            <ng-container
                [ngTemplateOutlet]="field"
                [ngTemplateOutletContext]="{ data: plant.edibility.edible ? 'Yes' : 'No', label: 'edible' }" />
            <ng-container
                [ngTemplateOutlet]="field"
                [ngTemplateOutletContext]="{ data: plant.edibility.parts, label: 'edible parts' }" />
        </mat-tab>
        <mat-tab label="Toxicity">
            <ng-container
                [ngTemplateOutlet]="field"
                [ngTemplateOutletContext]="{ data: plant.toxicity.toxic ? 'Yes' : 'No', label: 'toxic' }" />
            <ng-container
                [ngTemplateOutlet]="field"
                [ngTemplateOutletContext]="{ data: plant.toxicity.parts, label: 'parts' }" />
            <ng-container
                [ngTemplateOutlet]="field"
                [ngTemplateOutletContext]="{ data: plant.toxicity.organisms, label: 'toxic to' }" />
        </mat-tab>
    </mat-tab-group>
</ng-template>

<!--Title template-->
<ng-template #title>
    <div class="plant-title">
        <span
            ><strong>{{ plant.scientificName }}</strong></span
        >
        <span
            ><small>({{ plant.commonName }})</small></span
        >
        <button
            mat-icon-button
            (click)="isDetailsDisplayed = !isDetailsDisplayed"
            [matTooltip]="isDetailsDisplayed ? 'Images' : 'Details'">
            <mat-icon>{{ isDetailsDisplayed ? "view_carousel" : "info" }}</mat-icon>
        </button>
    </div>
</ng-template>
